<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì±„ìš©ê³µê³  - ì½”ì•„ì‹œì•„ HR í¬í„¸</title>
  
  <link rel="icon" type="image/png" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¢</text></svg>">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/style.css">
  
  <style>
    .page-header {
      background: linear-gradient(135deg, #0052A5 0%, #003D7A 100%);
      color: white;
      padding: 48px 0;
      margin-bottom: 48px;
    }
    
    .search-filter-section {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      padding: 32px;
      margin-bottom: 32px;
    }
    
    .filter-group {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      align-items: end;
    }
    
    .filter-item {
      flex: 1;
      min-width: 200px;
    }
    
    .job-list {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }
    
    .job-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      padding: 32px;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .job-card:hover {
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
      transform: translateY(-4px);
    }
    
    .job-card-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 16px;
    }
    
    .job-badges {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    .job-title {
      font-size: 22px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 12px;
    }
    
    .job-meta {
      display: flex;
      gap: 24px;
      flex-wrap: wrap;
      color: var(--text-secondary);
      font-size: 14px;
      margin-bottom: 16px;
    }
    
    .job-meta-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .job-description {
      color: var(--text-secondary);
      line-height: 1.6;
      margin-bottom: 20px;
    }
    
    .job-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 20px;
      border-top: 1px solid var(--border-color);
    }
    
    .job-actions {
      display: flex;
      gap: 12px;
    }
    
    .empty-state {
      text-align: center;
      padding: 80px 20px;
    }
    
    .empty-state i {
      font-size: 64px;
      color: var(--text-secondary);
      margin-bottom: 24px;
    }
    
    @media (max-width: 767px) {
      .page-header {
        padding: 32px 0;
      }
      
      .search-filter-section {
        padding: 24px 16px;
      }
      
      .filter-group {
        flex-direction: column;
      }
      
      .filter-item {
        width: 100%;
        min-width: unset;
      }
      
      .job-card {
        padding: 24px 16px;
      }
      
      .job-card-header {
        flex-direction: column;
        gap: 12px;
      }
      
      .job-meta {
        flex-direction: column;
        gap: 8px;
      }
      
      .job-footer {
        flex-direction: column;
        gap: 16px;
        align-items: stretch;
      }
      
      .job-actions {
        width: 100%;
      }
      
      .job-actions .btn {
        flex: 1;
      }
    }
  </style>
  <script src="../js/header-loader.js"></script>
</head>
<body>
  <!-- Header will be loaded automatically by header-loader.js -->

  <!-- Page Header -->
  <div class="page-header">
    <div class="container">
      <h1 style="font-size: 36px; margin-bottom: 12px; color: white;">
        <i class="fas fa-briefcase"></i>
        ì±„ìš©ê³µê³ 
      </h1>
      <p style="font-size: 18px; color: rgba(255,255,255,0.9); margin: 0;">
        ì½”ì•„ì‹œì•„ ê·¸ë£¹ê³¼ í•¨ê»˜ ì„±ì¥í•  ì¸ì¬ë¥¼ ì°¾ìŠµë‹ˆë‹¤
      </p>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container" style="margin-bottom: 80px;">
    <!-- Search & Filter -->
    <div class="search-filter-section">
      <div class="filter-group">
        <div class="filter-item" style="flex: 2;">
          <label class="form-label">ê²€ìƒ‰</label>
          <input 
            type="text" 
            class="form-input" 
            id="search-keyword" 
            placeholder="ì§ë¬´ëª…, í‚¤ì›Œë“œ ê²€ìƒ‰..."
            onkeypress="handleSearchKeypress(event)"
          >
        </div>
        
        <div class="filter-item">
          <label class="form-label">ë¶€ë¬¸</label>
          <select class="form-select" id="filter-department" onchange="loadJobs()">
            <option value="">ì „ì²´</option>
            <option value="ì œì¡°ë¶€ë¬¸">ì œì¡°ë¶€ë¬¸</option>
            <option value="ë°˜ë„ì²´ë¶€ë¬¸">ë°˜ë„ì²´ë¶€ë¬¸</option>
            <option value="íˆ¬ìë¶€ë¬¸">íˆ¬ìë¶€ë¬¸</option>
            <option value="ì§€ì£¼ì‚¬">ì§€ì£¼ì‚¬</option>
          </select>
        </div>
        
        <div class="filter-item">
          <label class="form-label">ê·¼ë¬´ì§€</label>
          <select class="form-select" id="filter-location" onchange="loadJobs()">
            <option value="">ì „ì²´</option>
            <option value="ì„œìš¸">ì„œìš¸</option>
            <option value="ì²œì•ˆ">ì²œì•ˆ</option>
            <option value="ì•„ì‚°">ì•„ì‚°</option>
            <option value="í•´ì™¸">í•´ì™¸</option>
          </select>
        </div>
        
        <div class="filter-item">
          <label class="form-label">ê³ ìš©í˜•íƒœ</label>
          <select class="form-select" id="filter-employment" onchange="loadJobs()">
            <option value="">ì „ì²´</option>
            <option value="ì •ê·œì§">ì •ê·œì§</option>
            <option value="ê³„ì•½ì§">ê³„ì•½ì§</option>
            <option value="ì¸í„´">ì¸í„´</option>
          </select>
        </div>
        
        <div class="filter-item">
          <label class="form-label">ê²½ë ¥</label>
          <select class="form-select" id="filter-experience" onchange="loadJobs()">
            <option value="">ì „ì²´</option>
            <option value="ì‹ ì…">ì‹ ì…</option>
            <option value="ê²½ë ¥">ê²½ë ¥</option>
            <option value="ë¬´ê´€">ë¬´ê´€</option>
          </select>
        </div>
        
        <button class="btn btn-primary" onclick="loadJobs()" style="height: 48px;">
          <i class="fas fa-search"></i>
          ê²€ìƒ‰
        </button>
      </div>
    </div>

    <!-- Results Info -->
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
      <div>
        <span style="font-size: 18px; font-weight: 600; color: var(--primary-color);" id="result-count">0</span>
        <span style="color: var(--text-secondary);">ê°œì˜ ì±„ìš©ê³µê³ </span>
      </div>
      <div>
        <select class="form-select" id="sort-by" onchange="loadJobs()" style="width: auto;">
          <option value="-created_at">ìµœì‹ ìˆœ</option>
          <option value="deadline">ë§ˆê°ì„ë°•ìˆœ</option>
          <option value="-views">ì¡°íšŒìˆ˜ìˆœ</option>
        </select>
      </div>
    </div>

    <!-- Job List -->
    <div class="job-list" id="job-list">
      <!-- Loading -->
      <div class="card text-center" style="padding: 80px;">
        <div class="spinner" style="margin: 0 auto 16px;"></div>
        <p style="color: var(--text-secondary);">ì±„ìš©ê³µê³ ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
      </div>
    </div>

    <!-- Pagination -->
    <div id="pagination" style="margin-top: 48px; display: flex; justify-content: center;"></div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h4>ì½”ì•„ì‹œì•„ ê·¸ë£¹</h4>
          <p style="color: rgba(255,255,255,0.8); font-size: 14px;">
            ì œì¡°Â·ë°˜ë„ì²´Â·íˆ¬ì ë¶€ë¬¸ì˜ ì„ ë„ ê¸°ì—…
          </p>
        </div>
        <div class="footer-section">
          <h4>ì±„ìš©ì •ë³´</h4>
          <ul class="footer-links">
            <li><a href="jobs.html">ì±„ìš©ê³µê³ </a></li>
            <li><a href="positions.html">ì§ë¬´ì†Œê°œ</a></li>
            <li><a href="faq.html">ì±„ìš© FAQ</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <p>Copyright Â© 2026 COASIA. All Rights Reserved.</p>
      </div>
    </div>
  </footer>

  <!-- Mobile Tab Bar -->
  <div class="mobile-tab-bar">
    <a href="../index.html" class="tab-item">
      <i class="fas fa-home"></i>
      <span>í™ˆ</span>
    </a>
    <a href="jobs.html" class="tab-item active">
      <i class="fas fa-briefcase"></i>
      <span>ì±„ìš©</span>
    </a>
    <a href="../education/courses.html" class="tab-item">
      <i class="fas fa-graduation-cap"></i>
      <span>êµìœ¡</span>
    </a>
    <a href="../mypage/dashboard.html" class="tab-item">
      <i class="fas fa-user"></i>
      <span>ë§ˆì´í˜ì´ì§€</span>
    </a>
  </div>

  <script src="../js/utils.js"></script>
  <script src="../js/auth.js"></script>
  <script>
    let currentPage = 1;
    const pageSize = 10;
    
    // ì±„ìš©ê³µê³  ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadJobs(page = 1) {
      currentPage = page;
      const jobList = document.getElementById('job-list');
      
      // í•„í„° ê°’ ê°€ì ¸ì˜¤ê¸°
      const keyword = document.getElementById('search-keyword').value.trim();
      const department = document.getElementById('filter-department').value;
      const location = document.getElementById('filter-location').value;
      const employment = document.getElementById('filter-employment').value;
      const experience = document.getElementById('filter-experience').value;
      const sortBy = document.getElementById('sort-by').value;
      
      // API ì¿¼ë¦¬ ìƒì„±
      let query = `tables/jobs?status=active&limit=${pageSize}&page=${page}`;
      
      if (keyword) query += `&search=${encodeURIComponent(keyword)}`;
      if (department) query += `&department=${encodeURIComponent(department)}`;
      if (location) query += `&location=${encodeURIComponent(location)}`;
      if (employment) query += `&employment_type=${encodeURIComponent(employment)}`;
      if (experience) query += `&experience=${encodeURIComponent(experience)}`;
      if (sortBy) query += `&sort=${sortBy}`;
      
      try {
        const response = await fetch(query);
        const data = await response.json();
        
        // ê²°ê³¼ ìˆ˜ ì—…ë°ì´íŠ¸
        document.getElementById('result-count').textContent = data.total || 0;
        
        if (data.data && data.data.length > 0) {
          // ê³µê³  ëª©ë¡ ë Œë”ë§
          jobList.innerHTML = data.data.map(job => {
            const dday = Utils.getDDay(job.deadline);
            const ddayClass = dday === 'ë§ˆê°' ? 'error' : (parseInt(dday.replace('D-', '')) <= 7 ? 'warning' : 'info');
            
            return `
              <div class="job-card" onclick="location.href='job-detail.html?id=${job.id}'">
                <div class="job-card-header">
                  <div class="job-badges">
                    <span class="badge badge-primary">${job.department || 'ë¶€ë¬¸'}</span>
                    <span class="badge badge-${ddayClass}">${dday}</span>
                  </div>
                  <button class="icon-btn" onclick="event.stopPropagation(); toggleBookmark('${job.id}')" title="ê´€ì‹¬ê³µê³ ">
                    <i class="far fa-heart"></i>
                  </button>
                </div>
                
                <h3 class="job-title">${job.title}</h3>
                
                <div class="job-meta">
                  <div class="job-meta-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>${job.location || 'ë¯¸ì •'}</span>
                  </div>
                  <div class="job-meta-item">
                    <i class="fas fa-briefcase"></i>
                    <span>${job.employment_type} Â· ${job.experience}</span>
                  </div>
                  <div class="job-meta-item">
                    <i class="fas fa-users"></i>
                    <span>ëª¨ì§‘ì¸ì› ${job.positions || 'ë¯¸ì •'}</span>
                  </div>
                  <div class="job-meta-item">
                    <i class="fas fa-calendar"></i>
                    <span>~ ${Utils.formatDate(job.deadline)}</span>
                  </div>
                </div>
                
                <div class="job-description">
                  ${Utils.truncate(job.description ? job.description.replace(/<[^>]*>/g, '') : 'ìƒì„¸ ë‚´ìš©ì„ í™•ì¸í•˜ì„¸ìš”', 150)}
                </div>
                
                <div class="job-footer">
                  <div style="color: var(--text-secondary); font-size: 13px;">
                    <i class="fas fa-eye"></i>
                    ì¡°íšŒ ${job.views || 0}
                  </div>
                  <div class="job-actions">
                    <button class="btn btn-outline btn-sm" onclick="event.stopPropagation(); shareJob('${job.id}')">
                      <i class="fas fa-share-alt"></i>
                      ê³µìœ 
                    </button>
                    <button class="btn btn-primary btn-sm">
                      <i class="fas fa-file-alt"></i>
                      ì§€ì›í•˜ê¸°
                    </button>
                  </div>
                </div>
              </div>
            `;
          }).join('');
          
          // í˜ì´ì§€ë„¤ì´ì…˜
          renderPagination(page, Math.ceil(data.total / pageSize));
        } else {
          // ë¹ˆ ìƒíƒœ
          jobList.innerHTML = `
            <div class="empty-state">
              <i class="fas fa-inbox"></i>
              <h3 style="margin-bottom: 12px;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
              <p style="color: var(--text-secondary); margin-bottom: 24px;">
                ê²€ìƒ‰ ì¡°ê±´ì„ ë³€ê²½í•˜ê±°ë‚˜ í•„í„°ë¥¼ ì´ˆê¸°í™”í•´ë³´ì„¸ìš”
              </p>
              <button class="btn btn-primary" onclick="resetFilters()">
                <i class="fas fa-redo"></i>
                í•„í„° ì´ˆê¸°í™”
              </button>
            </div>
          `;
          document.getElementById('pagination').innerHTML = '';
        }
      } catch (error) {
        console.error('Failed to load jobs:', error);
        jobList.innerHTML = `
          <div class="alert alert-error">
            <i class="fas fa-exclamation-circle"></i>
            <span>ì±„ìš©ê³µê³ ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</span>
          </div>
        `;
      }
    }
    
    // í˜ì´ì§€ë„¤ì´ì…˜ ë Œë”ë§
    function renderPagination(currentPage, totalPages) {
      const pagination = document.getElementById('pagination');
      if (totalPages <= 1) {
        pagination.innerHTML = '';
        return;
      }
      
      let html = '<div style="display: flex; gap: 8px;">';
      
      // ì´ì „
      if (currentPage > 1) {
        html += `<button class="btn btn-outline btn-sm" onclick="loadJobs(${currentPage - 1})">
          <i class="fas fa-chevron-left"></i>
        </button>`;
      }
      
      // í˜ì´ì§€ ë²ˆí˜¸
      const startPage = Math.max(1, currentPage - 2);
      const endPage = Math.min(totalPages, currentPage + 2);
      
      for (let i = startPage; i <= endPage; i++) {
        html += `<button class="btn ${i === currentPage ? 'btn-primary' : 'btn-outline'} btn-sm" 
          onclick="loadJobs(${i})">${i}</button>`;
      }
      
      // ë‹¤ìŒ
      if (currentPage < totalPages) {
        html += `<button class="btn btn-outline btn-sm" onclick="loadJobs(${currentPage + 1})">
          <i class="fas fa-chevron-right"></i>
        </button>`;
      }
      
      html += '</div>';
      pagination.innerHTML = html;
    }
    
    // í•„í„° ì´ˆê¸°í™”
    function resetFilters() {
      document.getElementById('search-keyword').value = '';
      document.getElementById('filter-department').value = '';
      document.getElementById('filter-location').value = '';
      document.getElementById('filter-employment').value = '';
      document.getElementById('filter-experience').value = '';
      document.getElementById('sort-by').value = '-created_at';
      loadJobs(1);
    }
    
    // ê²€ìƒ‰ í‚¤í”„ë ˆìŠ¤
    function handleSearchKeypress(e) {
      if (e.key === 'Enter') {
        loadJobs(1);
      }
    }
    
    // ë¶ë§ˆí¬ í† ê¸€
    async function toggleBookmark(jobId) {
      if (!Auth.isLoggedIn()) {
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        window.location.href = '../login.html';
        return;
      }
      
      try {
        const checkResponse = await fetch(`tables/bookmarks?user_id=${Auth.currentUser.id}&job_id=${jobId}`);
        const checkData = await checkResponse.json();
        
        if (checkData.data && checkData.data.length > 0) {
          await fetch(`tables/bookmarks/${checkData.data[0].id}`, { method: 'DELETE' });
          Utils.showAlert('ê´€ì‹¬ê³µê³ ì—ì„œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        } else {
          await fetch('tables/bookmarks', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              user_id: Auth.currentUser.id,
              job_id: jobId,
              created_at: new Date().toISOString()
            })
          });
          Utils.showAlert('ê´€ì‹¬ê³µê³ ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }
      } catch (error) {
        console.error('Failed to toggle bookmark:', error);
        Utils.showAlert('ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
      }
    }
    
    // ê³µìœ 
    function shareJob(jobId) {
      const url = `${window.location.origin}/recruit/job-detail.html?id=${jobId}`;
      if (navigator.share) {
        navigator.share({
          title: 'ì½”ì•„ì‹œì•„ ì±„ìš©ê³µê³ ',
          url: url
        });
      } else {
        navigator.clipboard.writeText(url);
        Utils.showAlert('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
      }
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ
    document.addEventListener('DOMContentLoaded', () => {
      loadJobs(1);
    });
  </script>
</body>
</html>
